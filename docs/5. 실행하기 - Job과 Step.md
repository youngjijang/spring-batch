# 배치 초기화

- JobLauncherApplicationRunner(BatchAutoConfiguration에서 생성됨)은 기본적으로 bean으로 등록된 모든 Job을 실행시킨다.
- Applicatin 실행시  Job 이름을 파라미터로 전달하여 지정한 Batch Job만 실행하도록 할 수 있다. (yaml에 하드코딩도 가능)
  <br>-> 5점대에서 여러개의 job 전달 받기?
- 환경 설정 파일(BatchProperties)을 통해 Job 이름, 스키마 초기화 세팅, 테이블 Prefix 등의 값을 설정할 수 있다.


# Job 과 Step

### JobBuilder

Job을 쉽게 생성 및 설정할 수 있도록하는 Util 성격의 클래스
- 설정조건에 따라 *두개의 하위 빌더 클래스*를 생성하고 Job을 위임한다. <br>
  (`SimpleJobBuilder`, `FlowJobBuilder`)

-> 빌더 클래스가 초기화되는 시점부터 JobRepository는 Job 객체에 전달되어 각각에 발생하는 메타 데이터들을 전달되어 기록되게 된다. (JobBuilderHelper -> SimpleJobRepository -> Job)

### SimpleJob

Step을 실행기키는 Job의 구현체로써 여러 단계의 Step으로 구성할 수 있으며 Step을 순차적으로 실행시킨다.
<br>

마지막에 실행한 Step의 BatchStatus가 Job의 최종 BatchStatus가 된다.

```java
  @Bean
	public Job simpleJob(JobRepository jobRepository, Step step) {
		return new JobBuilder("simpleJob", jobRepository)
				.start(step) // Step type의 인자가 전달되면 SimpleJobBuiler 반환
				.next(step)
				.incrementer(new RunIdIncrementer()) /// JobParameter의 값을 자동 증가해주는 설정
				.preventRestart() // Job의 재시작 방어 (Default true)
				.validator(new DefaultJobParametersValidator()) // JobParameter 검증
				.listener(jobExecutionListener) // Job 라이프 사이클의 특정 시점에 콜백을 제공하는 listener 설정
				.build(); // Job 생성
	}
```
- validator
  : DefaultJobParametersValidator -> requiredKey와 optionalKey를 지정할 수 있다.
  : jobRepository에 무언가 생성되기전 (SimpleJobLauncher) , Job이 실행(execute)되기전 두번이 실행된다. 

- preventRestart 
  : 실패한 경우에도 재시작을 지원하지 않는다.

- incrementer
  : 기존의 JobParameter 변경없이 Job을 여러번 실행하고자 할때 
  : RunIdIncrementer -> id를 생성해 순차적으로 1씩 증가시켜 param 값을 변경한다.



### StepBuilder

### TaskletStep

### JobStep